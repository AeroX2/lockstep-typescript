!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=15)}([function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,n){var i=n(4),r=n(5),o=n(6),s=n(7),a=n(8),u=n(9),c=n(10);c.alea=i,c.xor128=r,c.xorwow=o,c.xorshift7=s,c.xor4096=a,c.tychei=u,t.exports=c},function(t,e,n){(function(t){var i;!function(t,r,o){function s(t){var e,n=this,i=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=i(" "),n.s1=i(" "),n.s2=i(" "),n.s0-=i(t),n.s0<0&&(n.s0+=1),n.s1-=i(t),n.s1<0&&(n.s1+=1),n.s2-=i(t),n.s2<0&&(n.s2+=1),i=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function u(t,e){var n=new s(t),i=e&&e.state,r=n.next;return r.int32=function(){return 4294967296*n.next()|0},r.double=function(){return r()+1.1102230246251565e-16*(2097152*r()|0)},r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=u:n(0)&&n(2)?void 0===(i=function(){return u}.call(e,n,e,r))||(r.exports=i):this.alea=u}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function s(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function u(t,e){var n=new s(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=u:n(0)&&n(2)?void 0===(i=function(){return u}.call(e,n,e,r))||(r.exports=i):this.xor128=u}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function s(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),i==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function u(t,e){var n=new s(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=u:n(0)&&n(2)?void 0===(i=function(){return u}.call(e,n,e,r))||(r.exports=i):this.xorwow=u}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function s(t){var e=this;e.next=function(){var t,n,i=e.x,r=e.i;return t=i[r],n=(t^=t>>>7)^t<<24,n^=(t=i[r+1&7])^t>>>10,n^=(t=i[r+3&7])^t>>>3,n^=(t=i[r+4&7])^t<<7,t=i[r+7&7],n^=(t^=t<<13)^t<<9,i[r]=n,e.i=r+1&7,n},function(t,e){var n,i=[];if(e===(0|e))i[0]=e;else for(e=""+e,n=0;n<e.length;++n)i[7&n]=i[7&n]<<15^e.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],t.x=i,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function u(t,e){null==t&&(t=+new Date);var n=new s(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&(i.x&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=u:n(0)&&n(2)?void 0===(i=function(){return u}.call(e,n,e,r))||(r.exports=i):this.xorshift7=u}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function s(t){var e=this;e.next=function(){var t,n,i=e.w,r=e.X,o=e.i;return e.w=i=i+1640531527|0,n=r[o+34&127],t=r[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=r[o]=n^t,e.i=o,n+(i^i>>>16)|0},function(t,e){var n,i,r,o,s,a=[],u=128;for(e===(0|e)?(i=e,e=null):(e+="\0",i=0,u=Math.max(u,e.length)),r=0,o=-32;o<u;++o)e&&(i^=e.charCodeAt((o+32)%e.length)),0===o&&(s=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(s=s+1640531527|0,r=0==(n=a[127&o]^=i+s)?r+1:0);for(r>=128&&(a[127&(e&&e.length||0)]=-1),r=127,o=512;o>0;--o)i=a[r+34&127],n=a[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,a[r]=i^n;t.w=s,t.X=a,t.i=r}(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function u(t,e){null==t&&(t=+new Date);var n=new s(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&(i.X&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=u:n(0)&&n(2)?void 0===(i=function(){return u}.call(e,n,e,r))||(r.exports=i):this.xor4096=u}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function s(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,i=e.d,r=e.a;return t=t<<25^t>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-i|0,e.d=i<<16^n>>>16^r,e.a=r-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var i=0;i<n.length+20;i++)e.b^=0|n.charCodeAt(i),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function u(t,e){var n=new s(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=u:n(0)&&n(2)?void 0===(i=function(){return u}.call(e,n,e,r))||(r.exports=i):this.tychei=u}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){var i;!function(r,o){var s,a=(0,eval)("this"),u=256,c=6,l="random",f=o.pow(u,c),h=o.pow(2,52),p=2*h,d=u-1;function _(t,e,n){var i=[],d=g(function t(e,n){var i,r=[],o=typeof e;if(n&&"object"==o)for(i in e)try{r.push(t(e[i],n-1))}catch(t){}return r.length?r:"string"==o?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[t,b(r)]:null==t?function(){try{var t;return s&&(t=s.randomBytes)?t=t(u):(t=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(t)),b(t)}catch(t){var e=a.navigator,n=e&&e.plugins;return[+new Date,a,n,a.screen,b(r)]}}():t,3),i),_=new v(i),w=function(){for(var t=_.g(c),e=f,n=0;t<h;)t=(t+n)*u,e*=u,n=_.g(1);for(;t>=p;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|_.g(4)},w.quick=function(){return _.g(4)/4294967296},w.double=w,g(b(_.S),r),(e.pass||n||function(t,e,n,i){return i&&(i.S&&y(i,_),t.state=function(){return y(_,{})}),n?(o[l]=t,e):t})(w,d,"global"in e?e.global:this==o,e.state)}function v(t){var e,n=t.length,i=this,r=0,o=i.i=i.j=0,s=i.S=[];for(n||(t=[n++]);r<u;)s[r]=r++;for(r=0;r<u;r++)s[r]=s[o=d&o+t[r%n]+(e=s[r])],s[o]=e;(i.g=function(t){for(var e,n=0,r=i.i,o=i.j,s=i.S;t--;)e=s[r=d&r+1],n=n*u+s[d&(s[r]=s[o=d&o+e])+(s[o]=e)];return i.i=r,i.j=o,n})(u)}function y(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function g(t,e){for(var n,i=t+"",r=0;r<i.length;)e[d&r]=d&(n^=19*e[d&r])+i.charCodeAt(r++);return b(e)}function b(t){return String.fromCharCode.apply(0,t)}if(g(o.random(),r),t.exports){t.exports=_;try{s=n(11)}catch(t){}}else void 0===(i=function(){return _}.call(e,n,e,t))||(t.exports=i)}([],Math)},function(t,e){},function(t,e,n){parcelRequire=function(e,i,r,o){var s="function"==typeof parcelRequire&&parcelRequire;function a(t,r){if(!i[t]){if(!e[t]){var o="function"==typeof parcelRequire&&parcelRequire;if(!r&&o)return o(t,!0);if(s)return s(t,!0);if("string"==typeof t)return n(13)(t);var u=new Error("Cannot find module '"+t+"'");throw u.code="MODULE_NOT_FOUND",u}l.resolve=function(n){return e[t][1][n]||n},l.cache={};var c=i[t]=new a.Module(t);e[t][0].call(c.exports,l,c,c.exports,this)}return i[t].exports;function l(t){return a(l.resolve(t))}}a.isParcelRequire=!0,a.Module=function(t){this.id=t,this.bundle=a,this.exports={}},a.modules=e,a.cache=i,a.parent=s,a.register=function(t,n){e[t]=[function(t,e){e.exports=n},{}]};for(var u=0;u<r.length;u++)a(r[u]);if(r.length){var c=a(r[r.length-1]);t.exports=c}return a}({vHo1:[function(t,e,n){var i={};i.useBlobBuilder=function(){try{return new Blob([]),!1}catch(t){return!0}}(),i.useArrayBufferView=!i.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(t){return!0}}(),e.exports.binaryFeatures=i;var r=e.exports.BlobBuilder;function o(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(r=e.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),o.prototype.append=function(t){"number"==typeof t?this._pieces.push(t):(this.flush(),this._parts.push(t))},o.prototype.flush=function(){if(this._pieces.length>0){var t=new Uint8Array(this._pieces);i.useArrayBufferView||(t=t.buffer),this._parts.push(t),this._pieces=[]}},o.prototype.getBuffer=function(){if(this.flush(),i.useBlobBuilder){for(var t=new r,e=0,n=this._parts.length;e<n;e++)t.append(this._parts[e]);return t.getBlob()}return new Blob(this._parts)},e.exports.BufferBuilder=o},{}],lHOc:[function(t,e,n){var i=t("./bufferbuilder").BufferBuilder,r=t("./bufferbuilder").binaryFeatures,o={unpack:function(t){return new s(t).unpack()},pack:function(t){var e=new a;return e.pack(t),e.getBuffer()}};function s(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function a(){this.bufferBuilder=new i}function u(t){var e=t.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}e.exports=o,s.prototype.unpack=function(){var t,e=this.unpack_uint8();if(e<128)return e;if((224^e)<32)return(224^e)-32;if((t=160^e)<=15)return this.unpack_raw(t);if((t=176^e)<=15)return this.unpack_string(t);if((t=144^e)<=15)return this.unpack_array(t);if((t=128^e)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}},s.prototype.unpack_uint8=function(){var t=255&this.dataView[this.index];return this.index++,t},s.prototype.unpack_uint16=function(){var t=this.read(2),e=256*(255&t[0])+(255&t[1]);return this.index+=2,e},s.prototype.unpack_uint32=function(){var t=this.read(4),e=256*(256*(256*t[0]+t[1])+t[2])+t[3];return this.index+=4,e},s.prototype.unpack_uint64=function(){var t=this.read(8),e=256*(256*(256*(256*(256*(256*(256*t[0]+t[1])+t[2])+t[3])+t[4])+t[5])+t[6])+t[7];return this.index+=8,e},s.prototype.unpack_int8=function(){var t=this.unpack_uint8();return t<128?t:t-256},s.prototype.unpack_int16=function(){var t=this.unpack_uint16();return t<32768?t:t-65536},s.prototype.unpack_int32=function(){var t=this.unpack_uint32();return t<Math.pow(2,31)?t:t-Math.pow(2,32)},s.prototype.unpack_int64=function(){var t=this.unpack_uint64();return t<Math.pow(2,63)?t:t-Math.pow(2,64)},s.prototype.unpack_raw=function(t){if(this.length<this.index+t)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+t+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,e},s.prototype.unpack_string=function(t){for(var e,n,i=this.read(t),r=0,o="";r<t;)(e=i[r])<128?(o+=String.fromCharCode(e),r++):(192^e)<32?(n=(192^e)<<6|63&i[r+1],o+=String.fromCharCode(n),r+=2):(n=(15&e)<<12|(63&i[r+1])<<6|63&i[r+2],o+=String.fromCharCode(n),r+=3);return this.index+=t,o},s.prototype.unpack_array=function(t){for(var e=new Array(t),n=0;n<t;n++)e[n]=this.unpack();return e},s.prototype.unpack_map=function(t){for(var e={},n=0;n<t;n++){var i=this.unpack(),r=this.unpack();e[i]=r}return e},s.prototype.unpack_float=function(){var t=this.unpack_uint32(),e=(t>>23&255)-127;return(0==t>>31?1:-1)*(8388607&t|8388608)*Math.pow(2,e-23)},s.prototype.unpack_double=function(){var t=this.unpack_uint32(),e=this.unpack_uint32(),n=(t>>20&2047)-1023;return(0==t>>31?1:-1)*((1048575&t|1048576)*Math.pow(2,n-20)+e*Math.pow(2,n-52))},s.prototype.read=function(t){var e=this.index;if(e+t<=this.length)return this.dataView.subarray(e,e+t);throw new Error("BinaryPackFailure: read index out of range")},a.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},a.prototype.pack=function(t){var e=typeof t;if("string"==e)this.pack_string(t);else if("number"==e)Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if("boolean"==e)!0===t?this.bufferBuilder.append(195):!1===t&&this.bufferBuilder.append(194);else if("undefined"==e)this.bufferBuilder.append(192);else{if("object"!=e)throw new Error('Type "'+e+'" not yet supported');if(null===t)this.bufferBuilder.append(192);else{var n=t.constructor;if(n==Array)this.pack_array(t);else if(n==Blob||n==File)this.pack_bin(t);else if(n==ArrayBuffer)r.useArrayBufferView?this.pack_bin(new Uint8Array(t)):this.pack_bin(t);else if("BYTES_PER_ELEMENT"in t)r.useArrayBufferView?this.pack_bin(new Uint8Array(t.buffer)):this.pack_bin(t.buffer);else if(n==Object)this.pack_object(t);else if(n==Date)this.pack_string(t.toString());else{if("function"!=typeof t.toBinaryPack)throw new Error('Type "'+n.toString()+'" not yet supported');this.bufferBuilder.append(t.toBinaryPack())}}}this.bufferBuilder.flush()},a.prototype.pack_bin=function(t){var e=t.length||t.byteLength||t.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(e)}this.bufferBuilder.append(t)},a.prototype.pack_string=function(t){var e=function(t){return t.length>600?new Blob([t]).size:t.replace(/[^\u0000-\u007F]/g,u).length}(t);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(e)}this.bufferBuilder.append(t)},a.prototype.pack_array=function(t){var e=t.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(e)}for(var n=0;n<e;n++)this.pack(t[n])},a.prototype.pack_integer=function(t){if(-32<=t&&t<=127)this.bufferBuilder.append(255&t);else if(0<=t&&t<=255)this.bufferBuilder.append(204),this.pack_uint8(t);else if(-128<=t&&t<=127)this.bufferBuilder.append(208),this.pack_int8(t);else if(0<=t&&t<=65535)this.bufferBuilder.append(205),this.pack_uint16(t);else if(-32768<=t&&t<=32767)this.bufferBuilder.append(209),this.pack_int16(t);else if(0<=t&&t<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(t);else if(-2147483648<=t&&t<=2147483647)this.bufferBuilder.append(210),this.pack_int32(t);else if(-0x8000000000000000<=t&&t<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(t);else{if(!(0<=t&&t<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(t)}},a.prototype.pack_double=function(t){var e=0;t<0&&(e=1,t=-t);var n=Math.floor(Math.log(t)/Math.LN2),i=t/Math.pow(2,n)-1,r=Math.floor(i*Math.pow(2,52)),o=Math.pow(2,32),s=e<<31|n+1023<<20|r/o&1048575,a=r%o;this.bufferBuilder.append(203),this.pack_int32(s),this.pack_int32(a)},a.prototype.pack_object=function(t){var e=Object.keys(t).length;if(e<=15)this.pack_uint8(128+e);else if(e<=65535)this.bufferBuilder.append(222),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(e)}for(var n in t)t.hasOwnProperty(n)&&(this.pack(n),this.pack(t[n]))},a.prototype.pack_uint8=function(t){this.bufferBuilder.append(t)},a.prototype.pack_uint16=function(t){this.bufferBuilder.append(t>>8),this.bufferBuilder.append(255&t)},a.prototype.pack_uint32=function(t){var e=4294967295&t;this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_uint64=function(t){var e=t/Math.pow(2,32),n=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)},a.prototype.pack_int8=function(t){this.bufferBuilder.append(255&t)},a.prototype.pack_int16=function(t){this.bufferBuilder.append((65280&t)>>8),this.bufferBuilder.append(255&t)},a.prototype.pack_int32=function(t){this.bufferBuilder.append(t>>>24&255),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},a.prototype.pack_int64=function(t){var e=Math.floor(t/Math.pow(2,32)),n=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)}},{"./bufferbuilder":"vHo1"}],sXtV:[function(t,e,n){"use strict";n.__esModule=!0,n.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,n.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],BHXf:[function(t,e,n){arguments[3],arguments[3];var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n.__esModule=!0;var r={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},o=1,s=i(t("js-binarypack")),a=t("./adapter");n.util={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:443,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(t){var e=parseInt(t,10);isNaN(parseInt(t,10))?n.util.logLevel=t?3:0:n.util.logLevel=e,n.util.log=n.util.warn=n.util.error=n.util.noop,n.util.logLevel>0&&(n.util.error=n.util._printWith("ERROR")),n.util.logLevel>1&&(n.util.warn=n.util._printWith("WARNING")),n.util.logLevel>2&&(n.util.log=n.util._print)},setLogFunction:function(t){t.constructor!==Function?n.util.warn("The log function you passed in is not a function. Defaulting to regular logs."):n.util._print=t},_printWith:function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t),n.util._print.apply(n.util,e)}},_print:function(){var t=!1,e=Array.prototype.slice.call(arguments);e.unshift("PeerJS: ");for(var n=0,i=e.length;n<i;n++)e[n]instanceof Error&&(e[n]="("+e[n].name+") "+e[n].message,t=!0);t?console.error.apply(console,e):console.log.apply(console,e)},defaultConfig:r,browser:window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported",supports:function(){if(void 0===a.RTCPeerConnection)return{};var t,e,n=!0,i=!0,o=!1,s=!1,u=!!window.webkitRTCPeerConnection;try{t=new a.RTCPeerConnection(r,{optional:[{RtpDataChannels:!0}]})}catch(t){n=!1,i=!1}if(n)try{e=t.createDataChannel("_PEERJSTEST")}catch(t){n=!1}if(n){try{e.binaryType="blob",o=!0}catch(t){}var c=new a.RTCPeerConnection(r,{});try{s=c.createDataChannel("_PEERJSRELIABLETEST",{}).reliable}catch(t){}c.close()}return i&&(i=!!t.addStream),t&&t.close(),{audioVideo:i,data:n,binaryBlob:o,binary:s,reliable:s,sctp:s,onnegotiationneeded:u}}(),validateId:function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(t)},validateKey:function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(t)},debug:!1,inherits:function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})},extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},pack:s.default.pack,unpack:s.default.unpack,log:function(){if(n.util.debug){var t=!1,e=Array.prototype.slice.call(arguments);e.unshift("PeerJS: ");for(var i=0,r=e.length;i<r;i++)e[i]instanceof Error&&(e[i]="("+e[i].name+") "+e[i].message,t=!0);t?console.error.apply(console,e):console.log.apply(console,e)}},setZeroTimeout:function(t){var e=[],n="zero-timeout-message";function i(i){i.source==t&&i.data==n&&(i.stopPropagation&&i.stopPropagation(),e.length&&e.shift()())}return t.addEventListener?t.addEventListener("message",i,!0):t.attachEvent&&t.attachEvent("onmessage",i),function(i){e.push(i),t.postMessage(n,"*")}}(window),chunk:function(t){for(var e,i=[],r=t.size,s=e=0,a=Math.ceil(r/n.util.chunkedMTU);s<r;){var u=Math.min(r,s+n.util.chunkedMTU),c=t.slice(s,u),l={__peerData:o,n:e,data:c,total:a};i.push(l),s=u,e+=1}return o+=1,i},blobToArrayBuffer:function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsArrayBuffer(t)},blobToBinaryString:function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsBinaryString(t)},binaryStringToArrayBuffer:function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=255&t.charCodeAt(n);return e.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return"https:"===location.protocol}}},{"js-binarypack":"lHOc","./adapter":"sXtV"}],"2JJl":[function(t,e,n){"use strict";function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function r(){}r.prototype._events=void 0,r.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,i=new Array(n);e<n;e++)i[e]=this._events[t][e].fn;return i},r.prototype.emit=function(t,e,n,i,r,o){if(!this._events||!this._events[t])return!1;var s,a,u=this._events[t],c=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(t,u.fn,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,i),!0;case 5:return u.fn.call(u.context,e,n,i,r),!0;case 6:return u.fn.call(u.context,e,n,i,r,o),!0}for(a=1,s=new Array(c-1);a<c;a++)s[a-1]=arguments[a];u.fn.apply(u.context,s)}else{var l,f=u.length;for(a=0;a<f;a++)switch(u[a].once&&this.removeListener(t,u[a].fn,!0),c){case 1:u[a].fn.call(u[a].context);break;case 2:u[a].fn.call(u[a].context,e);break;case 3:u[a].fn.call(u[a].context,e,n);break;default:if(!s)for(l=1,s=new Array(c-1);l<c;l++)s[l-1]=arguments[l];u[a].fn.apply(u[a].context,s)}}return!0},r.prototype.on=function(t,e,n){var r=new i(e,n||this);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],r]:this._events[t].push(r):this._events[t]=r,this},r.prototype.once=function(t,e,n){var r=new i(e,n||this,!0);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],r]:this._events[t].push(r):this._events[t]=r,this},r.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var i=this._events[t],r=[];if(e&&(i.fn&&(i.fn!==e||n&&!i.once)&&r.push(i),!i.fn))for(var o=0,s=i.length;o<s;o++)(i[o].fn!==e||n&&!i[o].once)&&r.push(i[o]);return r.length?this._events[t]=1===r.length?r[0]:r:delete this._events[t],this},r.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.EventEmitter=r,r.EventEmitter2=r,r.EventEmitter3=r,e.exports=r},{}],wJlv:[function(t,e,n){"use strict";n.__esModule=!0;var i=t("./util"),r=t("eventemitter3");function o(t,e,n,i,s,a){if(!(this instanceof o))return new o(t,e,n,i,s,a);a=a||n,r.EventEmitter.call(this),this.disconnected=!1,this._queue=[];var u=t?"https://":"http://",c=t?"wss://":"ws://";this._httpUrl=u+e+":"+n+i+s,this._wsUrl=c+e+":"+a+i+"peerjs?key="+s}n.Socket=o,i.util.inherits(o,r.EventEmitter),o.prototype.start=function(t,e){this.id=t,this._httpUrl+="/"+t+"/"+e,this._wsUrl+="&id="+t+"&token="+e,this._startXhrStream(),this._startWebSocket()},o.prototype._startWebSocket=function(t){var e=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(t){try{var n=JSON.parse(t.data)}catch(e){return void i.util.log("Invalid server message",t.data)}e.emit("message",n)},this._socket.onclose=function(t){i.util.log("Socket closed."),e.disconnected=!0,e.emit("disconnected")},this._socket.onopen=function(){e._timeout&&(clearTimeout(e._timeout),setTimeout(function(){e._http.abort(),e._http=null},5e3)),e._sendQueuedMessages(),i.util.log("Socket open")})},o.prototype._startXhrStream=function(t){try{var e=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=t||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onerror=function(){clearTimeout(e._timeout),e.emit("disconnected")},this._http.onreadystatechange=function(){2==this.readyState&&this.old?(this.old.abort(),delete this.old):this.readyState>2&&200===this.status&&this.responseText&&e._handleStream(this)},this._http.send(null),this._setHTTPTimeout()}catch(t){i.util.log("XMLHttpRequest not available; defaulting to WebSockets")}},o.prototype._handleStream=function(t){var e=t.responseText.split("\n");if(t._buffer)for(;t._buffer.length>0;){var n=t._buffer.shift(),r=e[n];try{r=JSON.parse(r)}catch(e){t._buffer.shift(n);break}this.emit("message",r)}var o=e[t._index];if(o)if(t._index+=1,t._index===e.length)t._buffer||(t._buffer=[]),t._buffer.push(t._index-1);else{try{o=JSON.parse(o)}catch(t){return void i.util.log("Invalid server message",o)}this.emit("message",o)}},o.prototype._setHTTPTimeout=function(){var t=this;this._timeout=setTimeout(function(){var e=t._http;t._wsOpen()?e.abort():(t._startXhrStream(e._streamIndex+1),t._http.old=e)},25e3)},o.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState},o.prototype._sendQueuedMessages=function(){for(var t=0,e=this._queue.length;t<e;t+=1)this.send(this._queue[t])},o.prototype.send=function(t){if(!this.disconnected)if(this.id)if(t.type){var e=JSON.stringify(t);if(this._wsOpen())this._socket.send(e);else{var n=new XMLHttpRequest,i=this._httpUrl+"/"+t.type.toLowerCase();n.open("post",i,!0),n.setRequestHeader("Content-Type","application/json"),n.send(e)}}else this.emit("error","Invalid message");else this._queue.push(t)},o.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)}},{"./util":"BHXf",eventemitter3:"2JJl"}],HCdX:[function(t,e,n){"use strict";n.__esModule=!0;var i=t("./util"),r=t("./adapter");function o(t,e){"addTrack"in e?t.getTracks().forEach(function(n){e.addTrack(n,t)}):"addStream"in e&&e.addStream(t)}n.Negotiator={pcs:{data:{},media:{}},queue:[]},n.Negotiator._idPrefix="pc_",n.Negotiator.startConnection=function(t,e){var r=n.Negotiator._getPeerConnection(t,e);if(t.pc=t.peerConnection=r,"media"===t.type&&e._stream&&o(e._stream,r),e.originator){if("data"===t.type){var s={};i.util.supports.sctp||(s={reliable:e.reliable});var a=r.createDataChannel(t.label,s);t.initialize(a)}n.Negotiator._makeOffer(t)}else n.Negotiator.handleSDP("OFFER",t,e.sdp)},n.Negotiator._getPeerConnection=function(t,e){var r;return n.Negotiator.pcs[t.type]||i.util.error(t.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),n.Negotiator.pcs[t.type][t.peer]||(n.Negotiator.pcs[t.type][t.peer]={}),n.Negotiator.pcs[t.type][t.peer],e.pc&&(r=n.Negotiator.pcs[t.type][t.peer][e.pc]),r&&"stable"===r.signalingState||(r=n.Negotiator._startPeerConnection(t)),r},n.Negotiator._startPeerConnection=function(t){i.util.log("Creating RTCPeerConnection.");var e=n.Negotiator._idPrefix+i.util.randomToken(),o={};"data"!==t.type||i.util.supports.sctp?"media"===t.type&&(o={optional:[{DtlsSrtpKeyAgreement:!0}]}):o={optional:[{RtpDataChannels:!0}]};var s=new r.RTCPeerConnection(t.provider.options.config,o);return n.Negotiator.pcs[t.type][t.peer][e]=s,n.Negotiator._setupListeners(t,s,e),s},n.Negotiator._setupListeners=function(t,e,n){var r=t.peer,s=t.id,a=t.provider;i.util.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&(i.util.log("Received ICE candidates for:",t.peer),a.socket.send({type:"CANDIDATE",payload:{candidate:e.candidate,type:t.type,connectionId:t.id},dst:r}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":i.util.log("iceConnectionState is disconnected, closing connections to "+r),t.emit("error",new Error("Negotiation of connection to "+r+" failed.")),t.close();break;case"disconnected":i.util.log("iceConnectionState is disconnected, closing connections to "+r);break;case"completed":e.onicecandidate=i.util.noop}},e.onicechange=e.oniceconnectionstatechange,i.util.log("Listening for data channel"),e.ondatachannel=function(t){i.util.log("Received data channel");var e=t.channel;a.getConnection(r,s).initialize(e)},i.util.log("Listening for remote stream"),e.ontrack=function(t){i.util.log("Received remote stream");var e=t.streams[0],n=a.getConnection(r,s);"media"===n.type&&o(e,n)}},n.Negotiator.cleanup=function(t){i.util.log("Cleaning up PeerConnection to "+t.peer);var e=t.pc;e&&(e.readyState&&"closed"!==e.readyState||"closed"!==e.signalingState)&&(e.close(),t.pc=null)},n.Negotiator._makeOffer=function(t){var e=t.pc,n=function(n){i.util.log("Created offer."),!i.util.supports.sctp&&"data"===t.type&&t.reliable&&(n.sdp=Reliable.higherBandwidthSDP(n.sdp)),e.setLocalDescription(n).then(function(){return i.util.log("Set localDescription: offer","for:",t.peer),void t.provider.socket.send({type:"OFFER",payload:{sdp:n,type:t.type,label:t.label,connectionId:t.id,reliable:t.reliable,serialization:t.serialization,metadata:t.metadata,browser:i.util.browser},dst:t.peer})}).catch(function(e){return function(e){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=e&&(t.provider.emitError("webrtc",e),i.util.log("Failed to setLocalDescription, ",e))}(e)})};e.createOffer(t.options.constraints).then(function(t){return n(t)}).catch(function(e){return function(e){t.provider.emitError("webrtc",e),i.util.log("Failed to createOffer, ",e)}(e)})},n.Negotiator._makeAnswer=function(t){var e=t.pc,n=function(n){i.util.log("Created answer."),!i.util.supports.sctp&&"data"===t.type&&t.reliable&&(n.sdp=Reliable.higherBandwidthSDP(n.sdp)),e.setLocalDescription(n).then(function(){return i.util.log("Set localDescription: answer","for:",t.peer),void t.provider.socket.send({type:"ANSWER",payload:{sdp:n,type:t.type,connectionId:t.id,browser:i.util.browser},dst:t.peer})}).catch(function(e){t.provider.emitError("webrtc",e),i.util.log("Failed to setLocalDescription, ",e)})};e.createAnswer().then(function(t){return n(t)}).catch(function(e){t.provider.emitError("webrtc",e),i.util.log("Failed to create answer, ",e)})},n.Negotiator.handleSDP=function(t,e,o){o=new r.RTCSessionDescription(o);var s=e.pc;i.util.log("Setting remote description",o),s.setRemoteDescription(o).then(function(){return i.util.log("Set remoteDescription:",t,"for:",e.peer),void("OFFER"===t&&n.Negotiator._makeAnswer(e))}).catch(function(t){e.provider.emitError("webrtc",t),i.util.log("Failed to setRemoteDescription, ",t)})},n.Negotiator.handleCandidate=function(t,e){var n=e.candidate,o=e.sdpMLineIndex;t.pc.addIceCandidate(new r.RTCIceCandidate({sdpMLineIndex:o,candidate:n})),i.util.log("Added ICE candidate for:",t.peer)}},{"./util":"BHXf","./adapter":"sXtV"}],dbHP:[function(t,e,n){"use strict";n.__esModule=!0;var i=t("./util"),r=t("eventemitter3"),o=t("./negotiator");function s(t,e,n){if(!(this instanceof s))return new s(t,e,n);r.EventEmitter.call(this),this.options=i.util.extend({},n),this.open=!1,this.type="media",this.peer=t,this.provider=e,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||s._idPrefix+i.util.randomToken(),this.localStream&&o.Negotiator.startConnection(this,{_stream:this.localStream,originator:!0})}n.MediaConnection=s,i.util.inherits(s,r.EventEmitter),s._idPrefix="mc_",s.prototype.addStream=function(t){i.util.log("Receiving stream",t),this.remoteStream=t,this.emit("stream",t)},s.prototype.handleMessage=function(t){var e=t.payload;switch(t.type){case"ANSWER":o.Negotiator.handleSDP(t.type,this,e.sdp),this.open=!0;break;case"CANDIDATE":o.Negotiator.handleCandidate(this,e.candidate);break;default:i.util.warn("Unrecognized message type:",t.type,"from peer:",this.peer)}},s.prototype.answer=function(t){if(this.localStream)i.util.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this.options._payload._stream=t,this.localStream=t,o.Negotiator.startConnection(this,this.options._payload);for(var e=this.provider._getMessages(this.id),n=0,r=e.length;n<r;n+=1)this.handleMessage(e[n]);this.open=!0}},s.prototype.close=function(){this.open&&(this.open=!1,o.Negotiator.cleanup(this),this.emit("close"))}},{"./util":"BHXf",eventemitter3:"2JJl","./negotiator":"HCdX"}],T9kO:[function(t,e,n){arguments[3],arguments[3];var i=t("js-binarypack"),r={debug:!1,inherits:function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})},extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},pack:i.pack,unpack:i.unpack,log:function(){if(r.debug){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift("Reliable: "),console.log.apply(console,t)}},setZeroTimeout:function(t){var e=[],n="zero-timeout-message";function i(i){i.source==t&&i.data==n&&(i.stopPropagation&&i.stopPropagation(),e.length&&e.shift()())}return t.addEventListener?t.addEventListener("message",i,!0):t.attachEvent&&t.attachEvent("onmessage",i),function(i){e.push(i),t.postMessage(n,"*")}}(this),blobToArrayBuffer:function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsArrayBuffer(t)},blobToBinaryString:function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsBinaryString(t)},binaryStringToArrayBuffer:function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=255&t.charCodeAt(n);return e.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};e.exports=r},{"js-binarypack":"lHOc"}],aYFJ:[function(t,e,n){var i=t("./util");function r(t,e){if(!(this instanceof r))return new r(t);this._dc=t,i.debug=e,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC()}r.prototype.send=function(t){var e=i.pack(t);e.size<this._mtu?this._handleSend(["no",e]):(this._outgoing[this._count]={ack:0,chunks:this._chunk(e)},i.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1)},r.prototype._setupInterval=function(){var t=this;this._timeout=setInterval(function(){var e=t._queue.shift();if(e._multiple)for(var n=0,i=e.length;n<i;n+=1)t._intervalSend(e[n]);else t._intervalSend(e)},this._interval)},r.prototype._intervalSend=function(t){var e=this;t=i.pack(t),i.blobToBinaryString(t,function(t){e._dc.send(t)}),0===e._queue.length&&(clearTimeout(e._timeout),e._timeout=null)},r.prototype._processAcks=function(){for(var t in this._outgoing)this._outgoing.hasOwnProperty(t)&&this._sendWindowedChunks(t)},r.prototype._handleSend=function(t){for(var e=!0,n=0,i=this._queue.length;n<i;n+=1){var r=this._queue[n];r===t?e=!1:r._multiple&&-1!==r.indexOf(t)&&(e=!1)}e&&(this._queue.push(t),this._timeout||this._setupInterval())},r.prototype._setupDC=function(){var t=this;this._dc.onmessage=function(e){var n=e.data;if(n.constructor===String){var r=i.binaryStringToArrayBuffer(n);n=i.unpack(r),t._handleMessage(n)}}},r.prototype._handleMessage=function(t){var e,n=t[1],r=this._incoming[n],o=this._outgoing[n];switch(t[0]){case"no":var s=n;s&&this.onmessage(i.unpack(s));break;case"end":if(e=r,this._received[n]=t[2],!e)break;this._ack(n);break;case"ack":if(e=o){var a=t[2];e.ack=Math.max(a,e.ack),e.ack>=e.chunks.length?(i.log("Time: ",new Date-e.timer),delete this._outgoing[n]):this._processAcks()}break;case"chunk":if(!(e=r)){if(!0===this._received[n])break;e={ack:["ack",n,0],chunks:[]},this._incoming[n]=e}var u=t[2],c=t[3];e.chunks[u]=new Uint8Array(c),u===e.ack[2]&&this._calculateNextAck(n),this._ack(n);break;default:this._handleSend(t)}},r.prototype._chunk=function(t){for(var e=[],n=t.size,r=0;r<n;){var o=Math.min(n,r+this._mtu),s={payload:t.slice(r,o)};e.push(s),r=o}return i.log("Created",e.length,"chunks."),e},r.prototype._ack=function(t){var e=this._incoming[t].ack;this._received[t]===e[2]&&(this._complete(t),this._received[t]=!0),this._handleSend(e)},r.prototype._calculateNextAck=function(t){for(var e=this._incoming[t],n=e.chunks,i=0,r=n.length;i<r;i+=1)if(void 0===n[i])return void(e.ack[2]=i);e.ack[2]=n.length},r.prototype._sendWindowedChunks=function(t){i.log("sendWindowedChunks for: ",t);for(var e=this._outgoing[t],n=e.chunks,r=[],o=Math.min(e.ack+this._window,n.length),s=e.ack;s<o;s+=1)n[s].sent&&s!==e.ack||(n[s].sent=!0,r.push(["chunk",t,s,n[s].payload]));e.ack+this._window>=n.length&&r.push(["end",t,n.length]),r._multiple=!0,this._handleSend(r)},r.prototype._complete=function(t){i.log("Completed called for",t);var e=this,n=this._incoming[t].chunks,r=new Blob(n);i.blobToArrayBuffer(r,function(t){e.onmessage(i.unpack(t))}),delete this._incoming[t]},r.higherBandwidthSDP=function(t){var e=navigator.appVersion.match(/Chrome\/(.*?) /);if(e&&(e=parseInt(e[1].split(".").shift()))<31){var n=t.split("b=AS:30");if(n.length>1)return n[0]+"b=AS:102400"+n[1]}return t},r.prototype.onmessage=function(t){},e.exports.Reliable=r},{"./util":"T9kO"}],GBTQ:[function(t,e,n){"use strict";n.__esModule=!0;var i=t("./util"),r=t("eventemitter3"),o=t("./negotiator"),s=t("reliable");function a(t,e,n){if(!(this instanceof a))return new a(t,e,n);r.EventEmitter.call(this),this.options=i.util.extend({serialization:"binary",reliable:!1},n),this.open=!1,this.type="data",this.peer=t,this.provider=e,this.id=this.options.connectionId||a._idPrefix+i.util.randomToken(),this.label=this.options.label||this.id,this.metadata=this.options.metadata,this.serialization=this.options.serialization,this.reliable=this.options.reliable,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},this.options._payload&&(this._peerBrowser=this.options._payload.browser),o.Negotiator.startConnection(this,this.options._payload||{originator:!0})}n.DataConnection=a,i.util.inherits(a,r.EventEmitter),a._idPrefix="dc_",a.prototype.initialize=function(t){this._dc=this.dataChannel=t,this._configureDataChannel()},a.prototype._configureDataChannel=function(){var t=this;i.util.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){i.util.log("Data channel connection success"),t.open=!0,t.emit("open")},!i.util.supports.sctp&&this.reliable&&(this._reliable=new s.Reliable(this._dc,i.util.debug)),this._reliable?this._reliable.onmessage=function(e){t.emit("data",e)}:this._dc.onmessage=function(e){t._handleDataMessage(e)},this._dc.onclose=function(e){i.util.log("DataChannel closed for:",t.peer),t.close()}},a.prototype._handleDataMessage=function(t){var e=this,n=t.data,r=n.constructor;if("binary"===this.serialization||"binary-utf8"===this.serialization){if(r===Blob)return void i.util.blobToArrayBuffer(n,function(t){n=i.util.unpack(t),e.emit("data",n)});if(r===ArrayBuffer)n=i.util.unpack(n);else if(r===String){var o=i.util.binaryStringToArrayBuffer(n);n=i.util.unpack(o)}}else"json"===this.serialization&&(n=JSON.parse(n));if(n.__peerData){var s=n.__peerData,a=this._chunkedData[s]||{data:[],count:0,total:n.total};return a.data[n.n]=n.data,a.count+=1,a.total===a.count&&(delete this._chunkedData[s],n=new Blob(a.data),this._handleDataMessage({data:n})),void(this._chunkedData[s]=a)}this.emit("data",n)},a.prototype.close=function(){this.open&&(this.open=!1,o.Negotiator.cleanup(this),this.emit("close"))},a.prototype.send=function(t,e){if(this.open)if(this._reliable)this._reliable.send(t);else{var n=this;if("json"===this.serialization)this._bufferedSend(JSON.stringify(t));else if("binary"===this.serialization||"binary-utf8"===this.serialization){var r=i.util.pack(t);if((i.util.chunkedBrowsers[this._peerBrowser]||i.util.chunkedBrowsers[i.util.browser])&&!e&&r.size>i.util.chunkedMTU)return void this._sendChunks(r);i.util.supports.sctp?i.util.supports.binaryBlob?this._bufferedSend(r):i.util.blobToArrayBuffer(r,function(t){n._bufferedSend(t)}):i.util.blobToBinaryString(r,function(t){n._bufferedSend(t)})}else this._bufferedSend(t)}else this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},a.prototype._bufferedSend=function(t){!this._buffering&&this._trySend(t)||(this._buffer.push(t),this.bufferSize=this._buffer.length)},a.prototype._trySend=function(t){try{this._dc.send(t)}catch(t){this._buffering=!0;var e=this;return setTimeout(function(){e._buffering=!1,e._tryBuffer()},100),!1}return!0},a.prototype._tryBuffer=function(){if(0!==this._buffer.length){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())}},a.prototype._sendChunks=function(t){for(var e=i.util.chunk(t),n=0,r=e.length;n<r;n+=1)t=e[n],this.send(t,!0)},a.prototype.handleMessage=function(t){var e=t.payload;switch(t.type){case"ANSWER":this._peerBrowser=e.browser,o.Negotiator.handleSDP(t.type,this,e.sdp);break;case"CANDIDATE":o.Negotiator.handleCandidate(this,e.candidate);break;default:i.util.warn("Unrecognized message type:",t.type,"from peer:",this.peer)}}},{"./util":"BHXf",eventemitter3:"2JJl","./negotiator":"HCdX",reliable:"aYFJ"}],Hxpd:[function(t,e,n){"use strict";n.__esModule=!0;var i=t("./util"),r=t("eventemitter3"),o=t("./socket"),s=t("./mediaconnection"),a=t("./dataconnection");function u(t,e){if(!(this instanceof u))return new u(t,e);r.EventEmitter.call(this),t&&t.constructor==Object?(e=t,t=void 0):t&&(t=t.toString()),(e=i.util.extend({debug:0,host:i.util.CLOUD_HOST,port:i.util.CLOUD_PORT,path:"/",token:i.util.randomToken(),config:i.util.defaultConfig},e)).key="peerjs",this.options=e,"/"===e.host&&(e.host=window.location.hostname),"/"!==e.path[0]&&(e.path="/"+e.path),"/"!==e.path[e.path.length-1]&&(e.path+="/"),void 0===e.secure&&e.host!==i.util.CLOUD_HOST?e.secure=i.util.isSecure():e.host==i.util.CLOUD_HOST&&(e.secure=!0),e.logFunction&&i.util.setLogFunction(e.logFunction),i.util.setLogLevel(e.debug),i.util.supports.audioVideo||i.util.supports.data?i.util.validateId(t)?(this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={},this._initializeServerConnection(),t?this._initialize(t):this._retrieveId()):this._delayedAbort("invalid-id",'ID "'+t+'" is invalid'):this._delayedAbort("browser-incompatible","The current browser does not support WebRTC")}n.Peer=u,i.util.inherits(u,r.EventEmitter),u.prototype._initializeServerConnection=function(){var t=this;this.socket=new o.Socket(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key,this.options.wsport),this.socket.on("message",function(e){t._handleMessage(e)}),this.socket.on("error",function(e){t._abort("socket-error",e)}),this.socket.on("disconnected",function(){t.disconnected||(t.emitError("network","Lost connection to server."),t.disconnect())}),this.socket.on("close",function(){t.disconnected||t._abort("socket-closed","Underlying socket is already closed.")})},u.prototype._retrieveId=function(t){var e=this,n=new XMLHttpRequest,r=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id";r+="?ts="+(new Date).getTime()+Math.random(),n.open("get",r,!0),n.onerror=function(t){i.util.error("Error retrieving ID",t);var n="";"/"===e.options.path&&e.options.host!==i.util.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),e._abort("server-error","Could not get an ID from the server."+n)},n.onreadystatechange=function(){4===n.readyState&&(200===n.status?e._initialize(n.responseText):n.onerror())},n.send(null)},u.prototype._initialize=function(t){this.id=t,this.socket.start(this.id,this.options.token)},u.prototype._handleMessage=function(t){var e,n=t.type,r=t.payload,o=t.src;switch(n){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",r.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":i.util.log("Received leave message from",o),this._cleanupPeer(o);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+o);break;case"OFFER":var u=r.connectionId;if((e=this.getConnection(o,u))&&(e.close(),i.util.warn("Offer received for existing Connection ID:",u)),"media"===r.type)e=new s.MediaConnection(o,this,{connectionId:u,_payload:r,metadata:r.metadata}),this._addConnection(o,e),this.emit("call",e);else{if("data"!==r.type)return void i.util.warn("Received malformed connection type:",r.type);e=new a.DataConnection(o,this,{connectionId:u,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable}),this._addConnection(o,e),this.emit("connection",e)}for(var c=this._getMessages(u),l=0,f=c.length;l<f;l+=1)e.handleMessage(c[l]);break;default:if(!r)return void i.util.warn("You received a malformed message from "+o+" of type "+n);var h=r.connectionId;(e=this.getConnection(o,h))&&e.pc?e.handleMessage(t):h?this._storeMessage(h,t):i.util.warn("You received an unrecognized message:",t)}},u.prototype._storeMessage=function(t,e){this._lostMessages[t]||(this._lostMessages[t]=[]),this._lostMessages[t].push(e)},u.prototype._getMessages=function(t){var e=this._lostMessages[t];return e?(delete this._lostMessages[t],e):[]},u.prototype.connect=function(t,e){if(this.disconnected)return i.util.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");var n=new a.DataConnection(t,this,e);return this._addConnection(t,n),n},u.prototype.call=function(t,e,n){if(this.disconnected)return i.util.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");if(e){(n=n||{})._stream=e;var r=new s.MediaConnection(t,this,n);return this._addConnection(t,r),r}i.util.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},u.prototype._addConnection=function(t,e){this.connections[t]||(this.connections[t]=[]),this.connections[t].push(e)},u.prototype.getConnection=function(t,e){var n=this.connections[t];if(!n)return null;for(var i=0,r=n.length;i<r;i++)if(n[i].id===e)return n[i];return null},u.prototype._delayedAbort=function(t,e){var n=this;i.util.setZeroTimeout(function(){n._abort(t,e)})},u.prototype._abort=function(t,e){i.util.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(t,e)},u.prototype.emitError=function(t,e){i.util.error("Error:",e),"string"==typeof e&&(e=new Error(e)),e.type=t,this.emit("error",e)},u.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},u.prototype._cleanup=function(){if(this.connections)for(var t=Object.keys(this.connections),e=0,n=t.length;e<n;e++)this._cleanupPeer(t[e]);this.emit("close")},u.prototype._cleanupPeer=function(t){for(var e=this.connections[t],n=0,i=e.length;n<i;n+=1)e[n].close()},u.prototype.disconnect=function(){var t=this;i.util.setZeroTimeout(function(){t.disconnected||(t.disconnected=!0,t.open=!1,t.socket&&t.socket.close(),t.emit("disconnected",t.id),t._lastServerId=t.id,t.id=null)})},u.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)i.util.log("Attempting reconnection to server with ID "+this._lastServerId),this.disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");i.util.error("In a hurry? We're still trying to make the initial connection!")}},u.prototype.listAllPeers=function(t){t=t||function(){};var e=this,n=new XMLHttpRequest,r=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers";r+="?ts="+(new Date).getTime()+Math.random(),n.open("get",r,!0),n.onerror=function(n){e._abort("server-error","Could not get peers from the server."),t([])},n.onreadystatechange=function(){if(4===n.readyState){if(401===n.status){var r;throw r=e.options.host!==i.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",t([]),new Error("It doesn't look like you have permission to list peers IDs. "+r)}200!==n.status?t([]):t(JSON.parse(n.responseText))}},n.send(null)}},{"./util":"BHXf",eventemitter3:"2JJl","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ"}],iTK6:[function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n.__esModule=!0;var r=t("./util"),o=t("./adapter"),s=t("./socket"),a=t("./mediaconnection"),u=t("./dataconnection"),c=t("./peer"),l=t("./negotiator"),f=i(t("js-binarypack"));window.Socket=s.Socket,window.MediaConnection=a.MediaConnection,window.DataConnection=u.DataConnection,window.Peer=c.Peer,window.RTCPeerConnection=o.RTCPeerConnection,window.RTCSessionDescription=o.RTCSessionDescription,window.RTCIceCandidate=o.RTCIceCandidate,window.Negotiator=l.Negotiator,window.util=r.util,window.BinaryPack=f.default,n.default=c.Peer},{"./util":"BHXf","./adapter":"sXtV","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./peer":"Hxpd","./negotiator":"HCdX","js-binarypack":"lHOc"}]},{},["iTK6"])},function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=13},function(t,e,n){(function(t){var n;n=function(){var t=null,e={};s("monochrome",null,[[0,0],[100,0]]),s("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),s("orange",[19,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),s("yellow",[47,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),s("green",[63,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),s("blue",[179,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),s("purple",[258,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),s("pink",[283,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]]);var n=[],i=function(s){if(void 0!==(s=s||{}).seed&&null!==s.seed&&s.seed===parseInt(s.seed,10))t=s.seed;else if("string"==typeof s.seed)t=function(t){for(var e=0,n=0;n!==t.length&&!(e>=Number.MAX_SAFE_INTEGER);n++)e+=t.charCodeAt(n);return e}(s.seed);else{if(void 0!==s.seed&&null!==s.seed)throw new TypeError("The seed value must be an integer or string");t=null}var l,f,h;if(null!==s.count&&void 0!==s.count){for(var p=s.count,d=[],_=0;_<s.count;_++)n.push(!1);for(s.count=null;p>d.length;)t&&s.seed&&(s.seed+=1),d.push(i(s));return s.count=p,d}return l=function(t){if(n.length>0){var i=function(t){if(isNaN(t)){if("string"==typeof t)if(e[t]){var n=e[t];if(n.hueRange)return n.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var i=u(t)[0];return r(i).hueRange}}else{var o=parseInt(t);if(o<360&&o>0)return r(t).hueRange}return[0,360]}(t.hue),s=o(i),a=(i[1]-i[0])/n.length,c=parseInt((s-i[0])/a);!0===n[c]?c=(c+2)%n.length:n[c]=!0;var l=(i[0]+c*a)%359,f=(i[0]+(c+1)*a)%359;return(s=o(i=[l,f]))<0&&(s=360+s),s}var i=function(t){if("number"==typeof parseInt(t)){var n=parseInt(t);if(n<360&&n>0)return[n,n]}if("string"==typeof t)if(e[t]){var i=e[t];if(i.hueRange)return i.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var r=u(t)[0];return[r,r]}return[0,360]}(t.hue);return(s=o(i))<0&&(s=360+s),s}(s),f=function(t,e){if("monochrome"===e.hue)return 0;if("random"===e.luminosity)return o([0,100]);var n=function(t){return r(t).saturationRange}(t),i=n[0],s=n[1];switch(e.luminosity){case"bright":i=55;break;case"dark":i=s-10;break;case"light":s=55}return o([i,s])}(l,s),h=function(t,e,n){var i=function(t,e){for(var n=r(t).lowerBounds,i=0;i<n.length-1;i++){var o=n[i][0],s=n[i][1],a=n[i+1][0],u=n[i+1][1];if(e>=o&&e<=a){var c=(u-s)/(a-o),l=s-c*o;return c*e+l}}return 0}(t,e),s=100;switch(n.luminosity){case"dark":s=i+20;break;case"light":i=(s+i)/2;break;case"random":i=0,s=100}return o([i,s])}(l,f,s),function(t,e){switch(e.format){case"hsvArray":return t;case"hslArray":return c(t);case"hsl":var n=c(t);return"hsl("+n[0]+", "+n[1]+"%, "+n[2]+"%)";case"hsla":var i=c(t),r=e.alpha||Math.random();return"hsla("+i[0]+", "+i[1]+"%, "+i[2]+"%, "+r+")";case"rgbArray":return a(t);case"rgb":var o=a(t);return"rgb("+o.join(", ")+")";case"rgba":var s=a(t),r=e.alpha||Math.random();return"rgba("+s.join(", ")+", "+r+")";default:return function(t){var e=a(t);function n(t){var e=t.toString(16);return 1==e.length?"0"+e:e}return"#"+n(e[0])+n(e[1])+n(e[2])}(t)}}([l,f,h],s)};function r(t){for(var n in t>=334&&t<=360&&(t-=360),e){var i=e[n];if(i.hueRange&&t>=i.hueRange[0]&&t<=i.hueRange[1])return e[n]}return"Color not found"}function o(e){if(null===t){var n=Math.random();return n+=.618033988749895,n%=1,Math.floor(e[0]+n*(e[1]+1-e[0]))}var i=e[1]||1,r=e[0]||0,o=(t=(9301*t+49297)%233280)/233280;return Math.floor(r+o*(i-r))}function s(t,n,i){var r=i[0][0],o=i[i.length-1][0],s=i[i.length-1][1],a=i[0][1];e[t]={hueRange:n,lowerBounds:i,saturationRange:[r,o],brightnessRange:[s,a]}}function a(t){var e=t[0];0===e&&(e=1),360===e&&(e=359),e/=360;var n=t[1]/100,i=t[2]/100,r=Math.floor(6*e),o=6*e-r,s=i*(1-n),a=i*(1-o*n),u=i*(1-(1-o)*n),c=256,l=256,f=256;switch(r){case 0:c=i,l=u,f=s;break;case 1:c=a,l=i,f=s;break;case 2:c=s,l=i,f=u;break;case 3:c=s,l=a,f=i;break;case 4:c=u,l=s,f=i;break;case 5:c=i,l=s,f=a}var h=[Math.floor(255*c),Math.floor(255*l),Math.floor(255*f)];return h}function u(t){t=3===(t=t.replace(/^#/,"")).length?t.replace(/(.)/g,"$1$1"):t;var e=parseInt(t.substr(0,2),16)/255,n=parseInt(t.substr(2,2),16)/255,i=parseInt(t.substr(4,2),16)/255,r=Math.max(e,n,i),o=r-Math.min(e,n,i),s=r?o/r:0;switch(r){case e:return[(n-i)/o%6*60||0,s,r];case n:return[60*((i-e)/o+2)||0,s,r];case i:return[60*((e-n)/o+4)||0,s,r]}}function c(t){var e=t[0],n=t[1]/100,i=t[2]/100,r=(2-n)*i;return[e,Math.round(n*i/(r<1?r:2-r)*1e4)/100,r/2*100]}return i}(),t&&t.exports&&(e=t.exports=n),e.randomColor=n}).call(this,n(1)(t))},function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"UnreliablePacket",function(){return k}),n.d(i,"InputPacket",function(){return x}),n.d(i,"AckPacket",function(){return C});var r={};n.r(r),n.d(r,"ReliablePacket",function(){return P}),n.d(r,"StartPacket",function(){return T}),n.d(r,"PlayerPacket",function(){return E}),n.d(r,"OtherClientsPacket",function(){return A});var o,s=function(){function t(t){this.peer_id=t,this.buffer=[],this.filled=!1}return t.prototype.items=function(){return this.buffer},t.prototype.length=function(){return this.buffer.length},t.prototype.clear=function(){this.buffer=[],this.filled=!1},t.prototype.add=function(t){this.buffer.map(function(t){return t.frame}).includes(t.frame)||this.buffer.push(t),this.buffer=this.buffer.sort(function(t,e){return t.frame-e.frame}),this.buffer.length>D.BUFFER_SIZE&&(this.filled=!0)},t.prototype.find_lowest=function(t){if(this.buffer.length<=0)throw"Buffer is empty, when trying to find lowest";for(var e=0;e<this.buffer.length;e++)if(this.buffer[e].frame!=t+e)return t+e;return this.buffer[this.buffer.length-1].frame},t.prototype.remove_old=function(t){this.buffer.splice(0,this.buffer.findIndex(function(e){return e.frame===t}))},t.prototype.popleft=function(){return this.buffer.shift()},t.prototype.popright=function(){return this.buffer.pop()},t.prototype.peek=function(){return this.buffer[0]},t}(),a=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(){function t(){this.id=-1,this.x=0,this.y=0,this.vx=0,this.vy=0,this.id=S.entity_id++}return t.prototype.update=function(t){},t.prototype.draw=function(t){},t.prototype.collides=function(t){return!1},t.prototype.collision=function(t){},t.prototype.collision_interaction=function(t){},t}(),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.update=function(t){this.x+=this.vx,this.y+=this.vy,this.vx*=.995,this.vy*=.995,this.x<this.radius&&(this.x=this.radius,this.vx=.9*-this.vx),this.x>t.width-this.radius&&(this.x=t.width-this.radius,this.vx=.9*-this.vx),this.y<this.radius&&(this.y=this.radius,this.vy=.9*-this.vy),this.y>t.height-this.radius&&(this.y=t.height-this.radius,this.vy=.9*-this.vy)},e}(u),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.collides=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)<this.radius+t.radius},e}(u),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.collision=function(t){var e=t.x-this.x,n=t.y-this.y,i=Math.sqrt(e*e+n*n);if(i<this.radius+t.radius){var r=e/i,o=n/i,s=(this.x+t.x)/2,a=(this.y+t.y)/2;this.x=s-r*this.radius,this.y=a-o*this.radius,t.x=s+r*t.radius,t.y=a+o*t.radius;var u=(this.vx-t.vx)*r+(this.vy-t.vy)*o,c=u*r,l=u*o;this.vx-=c,this.vy-=l,t.vx+=c,t.vy+=l}},e}(u),h=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),p=n(14),d=function(t){function e(n,i){var r=t.call(this)||this;return r.radius=e.RADIUS,r.speed=.5,r.x=n,r.y=i,r.colour=p({luminosity:"dark",seed:w.int32()}),r}return h(e,t),e.prototype.input=function(t){t.up&&(this.vy-=this.speed),t.down&&(this.vy+=this.speed),t.left&&(this.vx-=this.speed),t.right&&(this.vx+=this.speed)},e.prototype.draw=function(t){t.fillStyle=this.colour,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()},e.RADIUS=20,e}(u),_=function(t){function e(e,n){return t.call(this,e,n)||this}return h(e,t),e}(d);function v(t,e){e.forEach(function(e){Object.getOwnPropertyNames(e.prototype).forEach(function(n){Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(e.prototype,n))})})}v(d,[c,f,l]),v(_,[c,f,l]);var y,g=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),b=function(t){function e(e,n){var i=t.call(this)||this;return i.radius=20,i.x=e,i.y=n,i}return g(e,t),e.prototype.draw=function(t){t.fillStyle=this.collidedWith?this.collidedWith.colour:"blue",t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),this.collidedWith?t.fill():t.stroke()},e.prototype.collision_interaction=function(t){(t instanceof d||t instanceof _)&&(this.collidedWith=t)},e}(u);y=b,[c,f,l].forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(e){Object.defineProperty(y.prototype,e,Object.getOwnPropertyDescriptor(t.prototype,e))})});var w,m=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),k=function(){function UnreliablePacket(){}return UnreliablePacket.prototype.raw=function(){return Object.assign({type:this.constructor.name},this)},UnreliablePacket.convert=function(t){var e=Object.create(i[t.type].prototype);return Object.assign(e,t)},UnreliablePacket}(),x=function(t){function InputPacket(e,n,i,r,o){var s=t.call(this)||this;return s.frame=e,s.up=n,s.down=i,s.left=r,s.right=o,s}return m(InputPacket,t),InputPacket}(k),C=function(t){function AckPacket(e){var n=t.call(this)||this;return n.ack=e,n}return m(AckPacket,t),AckPacket}(k),S=function(){function t(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d")}return t.prototype.setup=function(){var e=this;t.frame=0,t.entity_id=0,this.current_input=new x(0,!1,!1,!1,!1),this.input_buffer=new s(""),this.old_input_buffer=new s(""),this.other_players=[];for(var n=0,i=Array.from(D.mapping.keys()).concat(D.local_id).sort();n<i.length;n++){var r=i[n],o=function(t,e){return Math.floor(w()*(e-t)+t)},a=o(d.RADIUS,this.canvas.width-d.RADIUS),u=o(this.canvas.height/2,this.canvas.width-d.RADIUS);r===D.local_id?this.local_player=new d(a,u):this.other_players[D.mapping.get(r)]=new _(a,u)}this.entities=[],this.entities.push(this.local_player),this.entities=this.entities.concat(this.other_players),this.scores=new Map;for(var c=0,l=this.entities;c<l.length;c++){var f=l[c];this.scores.set(f.id,0)}this.max_scores=[-1];var h=[new b(400,250)];h.push(new b(h[0].x-20-2,h[0].y-40)),h.push(new b(h[0].x+20+2,h[0].y-40)),h.push(new b(h[0].x-40-2,h[0].y-80)),h.push(new b(h[0].x,h[0].y-80)),h.push(new b(h[0].x+40+2,h[0].y-80)),h.push(new b(h[0].x-20-2,h[0].y-120)),h.push(new b(h[0].x-60-4,h[0].y-120)),h.push(new b(h[0].x+20+2,h[0].y-120)),h.push(new b(h[0].x+60+4,h[0].y-120)),this.balls=h,this.entities=this.entities.concat(h),window.onkeydown=function(t){"ArrowUp"===t.key&&(e.current_input.up=!0),"ArrowDown"===t.key&&(e.current_input.down=!0),"ArrowLeft"===t.key&&(e.current_input.left=!0),"ArrowRight"===t.key&&(e.current_input.right=!0)},window.onkeyup=function(t){"ArrowUp"===t.key&&(e.current_input.up=!1),"ArrowDown"===t.key&&(e.current_input.down=!1),"ArrowLeft"===t.key&&(e.current_input.left=!1),"ArrowRight"===t.key&&(e.current_input.right=!1)}},t.prototype.simulate=function(e){var n=this.input_buffer.popleft(),i=t.frame*t.FPS,r=t.GAME_START_COUNTDOWN,o=r+t.GAME_END_COUNTDOWN,s=o+t.GAME_END_SCORE_COUNTDOWN;if(i<=r);else if(i<o){this.local_player.input(n);for(var a=0;a<e.length;a++)this.other_players[a].input(e[a]);this.update()}else if(i===o)for(var u=0,c=this.balls;u<c.length;u++){var l=c[u];if(l.collidedWith){var f=this.scores.get(l.collidedWith.id)+1;this.scores.set(l.collidedWith.id,f),f===this.max_scores[0]?this.max_scores.push():f>this.max_scores[0]&&(this.max_scores=[f])}}else i<=s||(D.reset(),this.setup());t.frame++},t.prototype.update=function(){for(var t=0,e=this.entities;t<e.length;t++){(r=e[t]).update(this.canvas)}for(var n=0,i=this.entities;n<i.length;n++){var r;if(!((r=i[n])instanceof d))for(var o=0,s=this.entities;o<s.length;o++){var a=s[o];r!==a&&(r.collides(a)&&(r.collision(a),r.collision_interaction(a)))}}},t.prototype.draw=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=0,n=this.entities;e<n.length;e++){n[e].draw(this.ctx)}var i=this.canvas.width/2,r=this.canvas.height/2,o=t.frame*t.FPS,s=t.GAME_START_COUNTDOWN,a=s+t.GAME_END_COUNTDOWN,u=a+t.GAME_END_SCORE_COUNTDOWN;if(this.ctx.fillStyle="black",o<=s){var c=(s-o)/1e3;this.ctx.textAlign="center",this.ctx.font="32px Ubuntu",this.ctx.fillText("Game will start in "+c.toFixed(2)+" seconds",i,r)}else if(o<=a){c=(a-o)/1e3;this.ctx.textAlign="left",this.ctx.font="16px Ubuntu",this.ctx.fillText("Game will end in "+c.toFixed(2)+" seconds",20,30)}else{this.ctx.textAlign="center",this.ctx.font="32px Ubuntu",this.max_scores.length>1?this.ctx.fillText("You Tied!",i,r):this.scores.get(this.local_player.id)==this.max_scores[0]?this.ctx.fillText("You WON!",i,r):this.ctx.fillText("You Lost :'(",i,r);c=(u-o)/1e3;this.ctx.fillText("Game will restart in "+c.toFixed(2)+" seconds",i,r+40),this.ctx.textAlign="left",this.ctx.font="16px Ubuntu";for(var l=function(t){var e=r+70+30*t,n=Array.from(f.scores.keys())[t],o=f.scores.get(n),s=f.entities.find(function(t){return t.id===n});f.ctx.fillStyle=s.colour,f.ctx.beginPath(),f.ctx.arc(i-70,e,10,0,2*Math.PI),f.ctx.stroke(),f.ctx.fill(),f.ctx.fillText("- had a score of "+o,i-50,e+5)},f=this,h=0;h<this.scores.size;h++)l(h)}},t.prototype.add_input=function(){if(this.input_buffer.length()<D.BUFFER_SIZE){var t=Object.create(this.current_input);t=Object.assign(t,this.current_input),this.input_buffer.add(t),this.old_input_buffer.add(t),this.current_input.frame++}},t.FPS=1e3/60,t.GAME_START_COUNTDOWN=3e3,t.GAME_END_COUNTDOWN=6e4,t.GAME_END_SCORE_COUNTDOWN=2e3,t}(),B=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),P=function(){function ReliablePacket(){}return ReliablePacket.prototype.raw=function(){return Object.assign({type:this.constructor.name},this)},ReliablePacket.convert=function(t){var e=Object.create(r[t.type].prototype);return Object.assign(e,t)},ReliablePacket}(),T=function(t){function StartPacket(e){var n=t.call(this)||this;return n.seed=e,n}return B(StartPacket,t),StartPacket}(P),E=function(t){function PlayerPacket(){return t.call(this)||this}return B(PlayerPacket,t),PlayerPacket}(P),A=function(t){function OtherClientsPacket(e){var n=t.call(this)||this;return n.others=e,n}return B(OtherClientsPacket,t),OtherClientsPacket}(P),O=function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}u((i=i.apply(t,e||[])).next())})},M=function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},R=new(n(12).default),D=function(){function t(){}return t.reset=function(){this.frame_they_are_missing=[],this.frame_we_are_missing=[];for(var t=0,e=this.buffers;t<e.length;t++){e[t].clear()}},t.open_socket=function(){return new Promise(function(e){R.on("open",function(n){console.log("My peer id is: "+n),t.local_id=n,e(n)}),R.on("connection",t.connection_opened)})},t.connection_made=function(e){t.mapping.set(e,t.index),t.buffers.push(new s(e)),t.frame_we_are_missing.push(0),t.index++},t.connection_opened=function(e){console.log((e.reliable?"Reliable":"Unreliable")+" Connection opened with "+e.peer);var n=t.mapping.get(e.peer);void 0===n&&(n=t.index,t.connection_made(e.peer)),e.reliable?(t.reliable_connections[n]=e,e.on("open",function(){if(e.on("data",function(n){t.receive_reliable(e.peer,n)}),t.reliable_connections.length-1>0){var n=new A(t.reliable_connections.slice(0,-1).map(function(t){return t.peer}));e.send(n.raw())}})):(t.unreliable_connections[n]=e,e.on("open",function(){e.on("data",function(n){t.receive_unreliable(e.peer,n)})}))},t.full_connect=function(e){console.log("Making a connection with "+e),t.local_id!==e?t.mapping.has(e)?console.log("Network connection with "+e+" already opened"):t.open_reliable(e).then(function(){return t.open_unreliable(e)}).then(function(){return t.connection_made(e)}).then(function(){return console.log("Connection made with "+e)}).catch(function(){return console.log("Unable to make connection made with "+e)}):console.log("Trying to make a connection with ourself")},t.open_reliable=function(e){var n=this;return new Promise(function(i){return O(n,void 0,void 0,function(){var n;return M(this,function(r){return(n=R.connect(e,{reliable:!0})).on("open",function(){t.reliable_connections.push(n),n.on("data",function(e){t.receive_reliable(n.peer,e)}),i()}),n.on("error",function(t){throw new Error("Unable to make reliable connection: "+t)}),[2]})})})},t.wait=function(t){return new Promise(function(e){setTimeout(function(){e()},t)})},t.open_unreliable=function(e){var n=this;return new Promise(function(i){return O(n,void 0,void 0,function(){var n;return M(this,function(r){return(n=R.connect(e)).on("open",function(){t.unreliable_connections.push(n),n.on("data",function(e){t.receive_unreliable(n.peer,e)}),i()}),n.on("error",function(t){throw new Error("Unable to make unreliable connection: "+t)}),[2]})})})},t.receive_reliable=function(e,n){if(console.log("Received reliable: ",n),(n=P.convert(n))instanceof A)for(var i=0,r=n.others;i<r.length;i++){var o=r[i];t.full_connect(o)}for(var s=0,a=t.reliable_callbacks;s<a.length;s++){(0,a[s])(e,n)}},t.receive_unreliable=function(e,n){if((n=k.convert(n))instanceof x){if(n.frame<S.frame)return;var i=t.mapping.get(e),r=t.buffers[i];r.add(n),t.frame_we_are_missing[i]=r.find_lowest(S.frame)}else if(n instanceof C){i=t.mapping.get(e);t.frame_they_are_missing[i]=n.ack}for(var o=0,s=t.unreliable_callbacks;o<s.length;o++){(0,s[o])(e,n)}},t.send_all_reliable=function(e){for(var n=e.raw(),i=0,r=t.reliable_connections;i<r.length;i++){r[i].send(n)}},t.send_input_buffer=function(e){var n=document.getElementById("packet-loss-slider"),i=parseInt(n.value)/100;document.getElementById("packet-loss-display").innerText="Packet loss: "+i;for(var r=e.items().map(function(t){return t.raw()}),o=0;o<t.unreliable_connections.length;o++){for(var s=t.unreliable_connections[o],a=t.frame_they_are_missing[o],u=0,c=r;u<c.length;u++){var l=c[u];l.frame>=a&&(Math.random()>=i?s.send(l):console.log("Simulating a lost packet"))}var f=t.frame_we_are_missing[o];s.send(new C(f).raw())}var h=Math.min.apply(Math,t.frame_they_are_missing);e.remove_old(h)},t.wait_for_buffers=function(){},t.BUFFER_SIZE=8,t.RETRY_AMOUNT=5,t.reliable_callbacks=[],t.unreliable_callbacks=[],t.mapping=new Map,t.index=0,t.buffers=[],t.reliable_connections=[],t.unreliable_connections=[],t.frame_we_are_missing=[],t.frame_they_are_missing=[],t}(),I=n(3);n.d(e,"Random",function(){return w}),console.log("Starting up"),D.open_socket().then(function(t){document.getElementById("peer-id-display").innerText="Your peer ID is: "+t});var N=new S,U=0;D.reliable_callbacks.push(function(t,e){console.log("Network callback"),e instanceof T?(console.log("Received start command"),w=I(e.seed),D.send_all_reliable(new E)):e instanceof E&&(U+=1)>=D.mapping.size&&(N.setup(),j())}),D.unreliable_callbacks.push(function(t,e){}),document.getElementById("connect-button").addEventListener("click",function(){var t=document.getElementById("textbox");D.full_connect(t.value.trim())}),document.getElementById("start-button").addEventListener("click",function(){console.log("Starting game");var t=Math.random().toString(36).substring(2);D.send_all_reliable(new T(t)),D.send_all_reliable(new E),w=I(t)});var j=function(){setTimeout(function(){N.add_input(),D.send_input_buffer(N.old_input_buffer),D.buffers.map(function(t){return t.peek()}).every(function(t){return t&&t.frame===S.frame})&&N.simulate(D.buffers.map(function(t){return t.popleft()})),N.draw(),window.requestAnimationFrame(j)},S.FPS)}}]);